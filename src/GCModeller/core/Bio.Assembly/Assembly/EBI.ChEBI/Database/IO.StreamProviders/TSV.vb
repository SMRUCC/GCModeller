#Region "Microsoft.VisualBasic::401fd8362838b873a496cd4a61d78b6d, ..\GCModeller\core\Bio.Assembly\Assembly\EBI.ChEBI\Database\IO.StreamProviders\TSV.vb"

' Author:
' 
'       asuka (amethyst.asuka@gcmodeller.org)
'       xieguigang (xie.guigang@live.com)
'       xie (genetics@smrucc.org)
' 
' Copyright (c) 2016 GPL3 Licensed
' 
' 
' GNU GENERAL PUBLIC LICENSE (GPL3)
' 
' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.
' 
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
' 
' You should have received a copy of the GNU General Public License
' along with this program. If not, see <http://www.gnu.org/licenses/>.

#End Region

Imports Microsoft.VisualBasic.ComponentModel.DataSourceModel

Namespace Assembly.EBI.ChEBI.Database.IO.StreamProviders.Tsv

    Public Class TSV : Inherits ComponentModel.TabularLazyLoader

        ''' <summary>
        ''' A complete tsv file list in the chebi ftp data directory.
        ''' </summary>
        ''' <returns></returns>
        Public Shared ReadOnly Property TsvFiles As String() = {
            "autogenerated_structures.tsv",
            "vertice.tsv",
            "relation.tsv",
            "reference.tsv",
            "ontology.tsv",
            "names.tsv",
            "default_structures.tsv",
            "database_accession.tsv",
            "compounds.tsv",
            "compound_origins.tsv",
            "comments.tsv",
            "chemical_data.tsv",
            "chebiId_inchi.tsv",
            "chebi_uniprot.tsv"
        }

        Dim Names As Tables.Names()
        Dim Accessions As Tables.Accession()

        ''' <summary>
        ''' 从ChEBI的ftp文件夹之中加载数据 
        ''' </summary>
        ''' <param name="DIR"></param>
        Sub New(DIR As String)
            Call MyBase.New(DIR, {"*.tsv"})
        End Sub

        Public Function GetNames(Optional filename As String = "names.tsv") As Tables.Names()
            Return __lazyLoadData(Of Tables.Names)(Names, filename)
        End Function

        ''' <summary>
        ''' Lazy loading
        ''' </summary>
        ''' <typeparam name="T"></typeparam>
        ''' <param name="fieldData"></param>
        ''' <param name="FileName"></param>
        ''' <returns></returns>
        Private Function __lazyLoadData(Of T As Tables.Entity)(ByRef fieldData As T(), FileName As String) As T()
            If fieldData.IsNullOrEmpty Then
                Dim path$ = $"{_DIR}/{FileName}"
                Call $"[{GetType(T).FullName}] Load data from {FileName}".__DEBUG_ECHO
                Dim st = Stopwatch.StartNew
                fieldData = TsvFileIO.Load(Of T)(FileName)
                Call $"[LOAD_DATA_DONE] Performance load {fieldData.Length} objects in {st.ElapsedMilliseconds} ms...".__DEBUG_ECHO
            End If
            Return fieldData
        End Function

        Public Function GetDatabaseAccessions(Optional filename As String = "database_accession.tsv") As Tables.Accession()
            Return __lazyLoadData(Of Tables.Accession)(Accessions, filename)
        End Function
    End Class
End Namespace
